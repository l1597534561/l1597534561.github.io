<html>
<head>
	<title>
		Line
	</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<body>
	<div style="width:60%;">
		<canvas id="myChart"></canvas>
	</div>
	
	<select name="cardNumber" id="cardNumber" onchange="changeNumber();"> 
		<option value="000/000-000">--選擇卡號--</option> 
	</select> 
</body>


<script>
			window.onload=function(){
			  setFun();  
			}

			var requestURL = 'https://l1597534561.github.io/cardData.json';
			var request = new XMLHttpRequest();	
						
			function setFun(){
			  var select = document.getElementById("cardNumber"); 
			  select.length = 1;
			  select.options[0].selected = true;		 
			  request.open('GET', requestURL);
			  request.responseType = 'json';
			  request.send();	
			
			  request.onload = function() {
			  var cards = request.response;
			  var cardNumber = '5HY/W83-001';
				  for(var key in cards){
					var option = document.createElement("option"); 
					option.setAttribute("value",key);
					option.appendChild(document.createTextNode(key)); 
					select.appendChild(option);
				  }
			  getCardData(cards,cardNumber)	  
			  }
			}
			
			
			function changeNumber(){
				request.open('GET', requestURL);
				request.responseType = 'json';
				request.send();
				request.onload = function() {
				  var cards = request.response;
				  var cardNumber = document.getElementById('cardNumber').value;
				  getCardData(cards,cardNumber)
				}
			}
			
			function getCardData(jsonObj,cardNum) {
			console.log(cardNum);
			  var cardInfo = jsonObj[cardNum];
				  		
				var cardNumber=cardNum;
				var cardPriceUpDate=cardInfo['upddate'];
				var cardData=cardInfo['cardPrice'];
				
				var ctx = document.getElementById('myChart').getContext('2d');
				var chart = new Chart(ctx, {
					// The type of chart we want to create
					type: 'line',

					// The data for our dataset
					data: {
						labels: cardPriceUpDate,
						datasets: [{
							label: cardNumber,
							//fill:false,
							borderColor: 'rgb(255, 99, 132)',
							data: cardData
						}],
					},
					// Configuration options go here
					options: {
						title:{
							display:true,
							text:'YuYuTei價格變化'
						},
						scales:{
							xAxes: [{
								display: true,
								scaleLabel: {
									display: true,
									labelString: '日期'
								}
							}],
							yAxes: [{
								display: true,
								scaleLabel: {
									display: true,
									labelString: '價格(日幣)'
								}
							}]
						}
					
					}
				});		
			}

</script>



</html>
